<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Thinking out aloud: a JavaScript based console?</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/">Your New Jekyll Site</a></h1>
              <a class="extra" href="/">home</a>
            </div>

                <h2>Thinking out aloud: a JavaScript based console?</h2>
<p class="meta">05 May 2011</p>

<div class="post">
<p>In the last month or two <a href="https://github.com/detro/phantomjs">I started contributing</a> to <a href="http://www.phantomjs.org">PhantomJS</a>:
<div class="img">
<img src="http://www.openclipart.org/image/800px/svg_to_png/lemmling_Cartoon_ghost.png" width="400" alt="PhantomJS logo"/>
PhantomJS logo
</div></p>

<blockquote>
PhantomJS is a headless WebKit with JavaScript API. It has fast and native support for various web standards: DOM handling, CSS selector, JSON, Canvas, and SVG.

PhantomJS is an optimal solution for headless testing of web-based applications, site scraping, pages capture, SVG renderer, PDF converter and many other use cases.
</blockquote>

<p>The project is really interesting and we are seeing a steady growth in terms of:</p>

<ul>
<li>Number of users</li>
<li>Number of posts/questions/answers on the <a href="https://groups.google.com/forum/#!forum/phantomjs">official Google group</a></li>
<li>Number of <a href="https://github.com/ariya/phantomjs/commits/master">contribution</a></li>
</ul>

<p>The mind behind PhantomJS is <a href="http://ariya.blogspot.com/">Ariya Hidayat</a>, a brilliant guy that I first met when he was still working for Trolltech/Nokia. I will not spend a lot of time here explaining why it&#39;s idea is so great: for that there is <a href="http://code.google.com/p/phantomjs/w/list">the official wiki</a>.</p>

<p>To share some awesomeness, here is my favourite example. <em>Do you want to know what&#39;s the weather like in London from your command line?</em> Type something like this:
[sourcecode:bash]
$ phantomjs examples/weather.js London, UK</p>

<p>City: London, UK
Current condition: Clear
Temperature: 61 F
Humidity: 45%
Wind: N at 4 mph</p>

<p>Thu: 52-66 F  Partly Sunny
Fri: 57-72 F  Partly Sunny
Sat: 55-72 F  Partly Sunny
Sun: 50-70 F  Chance of Rain
[/sourcecode]</p>

<p>How does that work? Here is the PhantomJS script source:
[sourcecode:javascript]
if phantom.state.length is 0
    city = &#39;Mountain View&#39;
    if phantom.args.length &gt; 0
        city = phantom.args.join &#39; &#39;
    phantom.state = city
    console.log &quot;Loading #{ city }&quot;
    phantom.open encodeURI &quot;http://www.google.com/ig/api?weather=#{ city }&quot;
else
    if phantom.loadStatus is &#39;fail&#39;
        console.log &#39;Unable to access network&#39;
    else
        if document.querySelectorAll(&#39;problem_cause&#39;).length &gt; 0
            console.log &quot;No data available for #{ phantom.state }&quot;
        else
            data = (s, e) -&gt;
                e = e or document
                el = e.querySelector s
                if el then el.attributes.data.value else null</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">        console.log &#39;&#39;
        console.log &#39;City: &#39; + data &#39;weather &gt; forecast_information &gt; city&#39;
        console.log &#39;Current condition &#39; + data &#39;weather &gt; current_conditions &gt; condition&#39;
        console.log &#39;Temperature: &#39; + data(&#39;weather &gt; current_conditions &gt; temp_f&#39;) + &#39; F&#39;
        console.log data &#39;weather &gt; current_conditions &gt; humidity&#39;
        console.log data &#39;weather &gt; current_conditions &gt; wind_condition&#39;
        console.log &#39;&#39;

        forecasts = document.querySelectorAll &#39;weather &gt; forecast_conditions&#39;
        for f in forecasts
            console.log &quot;#{ data &#39;day_of_week&#39;, f }: &quot; +
                        &quot;#{ data &#39;low&#39;, f }-&quot; +
                        &quot;#{ data &#39;high&#39;, f } F  &quot; +
                        &quot;#{ data &#39;condition&#39;, f }&quot;

phantom.exit()
</code></pre></div>
<p>[/sourcecode]</p>

<p>This scripts uses the <em>undocumented</em> <a href="http://www.google.com/search?sourceid=chrome&amp;ie=UTF-8&amp;q=google+api+weather#sclient=psy&amp;hl=en&amp;safe=off&amp;source=hp&amp;q=google+weather+api&amp;aq=f&amp;aqi=&amp;aql=&amp;oq=&amp;pbx=1&amp;bav=on.2,or.r_gc.r_pw.&amp;fp=ee59edf59cfa0598">Google Weather API</a>. Nothing special given <em>nowdays</em> Javascript... but this is bring the result to your CLI! And yep, PhantomJS supports <strong>Coffee Script</strong>, as well as Javascript.</p>

<p>Isn&#39;t this enough to make your eyes sparkly?</p>

<h2>a JavaScript based console?</h2>

<p>Anyway, I&#39;m not here to show what&#39;s available. I&#39;m here to throw an idea out.</p>

<p>PhantomJS is based on the super-awesome Qt. And Qt provides a <strong>superb</strong> API set. The one that makes PhantomJS possible is <a href="http://trac.webkit.org/wiki/QtWebKit">QtWebKit</a>, a <a href="http:///webkit.org">WebKit</a> flavour that is developed side by side with the Google Chrome and the Apple Safari WebKits, on <a href="http://trac.webkit.org/">the official WebKit repo</a>. <a href="http://doc.qt.nokia.com/latest/qtwebkit.html">QtWebKit API</a> make it extremely easy to build software based on WebKit.</p>

<p>Qt also provides other great modules, and one of them is <a href="http://doc.qt.nokia.com/latest/qtscript.html">QtScript</a>. Based on? Yes, it&#39;s based on Javascript! Actually, it wraps in a great API the &quot;standard&quot; <a href="http://www.webkit.org/projects/javascript/">WebKit JavascriptCode</a>.</p>

<p>So, if you do <em>1+1</em> what happens? <strong>PhantomJS can become a fully fledged Javascript interpreter!</strong> The WebPage could just be an object to manipulate as a &quot;resource&quot;, like any other object. The developer could do thinks like:
[sourcecode:javascript]
var page = require(&quot;WebPage&quot;);
page.load(&quot;www.google.com&quot;);
page.input(&quot;Lady Gaga&quot;, &quot;#inputTextField&quot;);
page.click(&quot;#submitSearch&quot;);
...
var rasterizer = require(&quot;Rasterizer&quot;);
rasterizer.print(page, &quot;~/ladyGagaSearchResult.png&quot;);
...
[/sourcecode]
Do you see where I&#39;m heading here?</p>

<p>Put into the picture the <a href="http://www.commonjs.org/">CommonJS</a> specs, still cooking, and you can imagine JavaScript reaching places that no one would have imagined few years ago.</p>

<p>We are discussing this <a href="https://groups.google.com/d/topic/phantomjs/0lOnBOL1oV8/discussion">here on the official group</a>. Come on, join in?</p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/yourusername/">github.com/yourusername</a><br />
                  <a href="http://twitter.com/yourusername/">twitter.com/yourusername</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
