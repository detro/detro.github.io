<!DOCTYPE html>
<html>
    <head>
        <link rel="icon" href="/favicon.ico" type="image/x-icon">
        <link type="application/atom+xml" rel="alternate" href="https://ivandemarino.me/atom.xml" title="Too much coffee, too little time" />

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

        <!-- Third Party CSS -->
        <link href="/css/thirdparty/purecss-combo.min.css" rel="stylesheet">
        <link href="/css/thirdparty/font-awesome/css/font-awesome.min.css" rel="stylesheet">
        <!--[if IE 7]>
            <link href="/css/thirdparty/font-awesome/css/font-awesome-ie7.min.css" rel="stylesheet" >
        <![endif]-->

        <!-- Theme CSS -->
        <link rel="stylesheet" href="/css/leo.css">

        <!-- Utility JS -->
        <script type="text/javascript" src="/js/normalize.js"></script>

        
            <script async src="https://www.googletagmanager.com/gtag/js?id=UA-136869-11"></script>
            <script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());

              gtag('config', 'UA-136869-11');
            </script>
        

        
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-K0JQTBH0J9"></script>
            <script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());

              gtag('config', 'G-K0JQTBH0J9');
            </script>
        

        <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Maven, PhantomJS and Jasmine to write your JS Unit Testing | Too much coffee, too little time</title>
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="Maven, PhantomJS and Jasmine to write your JS Unit Testing" />
<meta name="author" content="detro" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In Betfair we are building all sort of new things, and one of the aspects on which we are trying to focus more is doing Automated Tests for JavaScript. Currently, all non-js code in Betfair passes through different kind of Automated (and Human) Testing (from Unit Testing, to Security, to Performance, to Human and Scripted QA), but the JavaScript language, by its very nature, makes it tricky to test in an automated fashion. It’s not impossible, just a bit harder than it should. A beautiful jasmine... Lately I have been spending a big chunk of my spare time lending a hand to the PhantomJS project, as some of you that know me might recall. Don’t break the flow That started because I saw in PhantomJS, and it’s headless nature, a great opportunity to contribute to the internal effort around JS Unit Testing. And because I wanted to allow both developers and CI-Servers to run JavaScript Tests with ease. I believe that if development experience it’s easy (and, I dare to say, FUN), code just flows! And if you can do testing with just one command from your CLI, the flow becomes almost beat. In Betfair we use Maven to drive our build system (yeah, I know, XML orgies are terrible…). So, we type a lot of:" />
<meta property="og:description" content="In Betfair we are building all sort of new things, and one of the aspects on which we are trying to focus more is doing Automated Tests for JavaScript. Currently, all non-js code in Betfair passes through different kind of Automated (and Human) Testing (from Unit Testing, to Security, to Performance, to Human and Scripted QA), but the JavaScript language, by its very nature, makes it tricky to test in an automated fashion. It’s not impossible, just a bit harder than it should. A beautiful jasmine... Lately I have been spending a big chunk of my spare time lending a hand to the PhantomJS project, as some of you that know me might recall. Don’t break the flow That started because I saw in PhantomJS, and it’s headless nature, a great opportunity to contribute to the internal effort around JS Unit Testing. And because I wanted to allow both developers and CI-Servers to run JavaScript Tests with ease. I believe that if development experience it’s easy (and, I dare to say, FUN), code just flows! And if you can do testing with just one command from your CLI, the flow becomes almost beat. In Betfair we use Maven to drive our build system (yeah, I know, XML orgies are terrible…). So, we type a lot of:" />
<link rel="canonical" href="https://ivandemarino.me/2011/07/09/Maven-PhantomJS-and-Jasmine-to-write-your-JS-Unit-Testing" />
<meta property="og:url" content="https://ivandemarino.me/2011/07/09/Maven-PhantomJS-and-Jasmine-to-write-your-JS-Unit-Testing" />
<meta property="og:site_name" content="Too much coffee, too little time" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2011-07-08T17:40:40+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Maven, PhantomJS and Jasmine to write your JS Unit Testing" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"detro"},"dateModified":"2011-07-08T17:40:40+01:00","datePublished":"2011-07-08T17:40:40+01:00","description":"In Betfair we are building all sort of new things, and one of the aspects on which we are trying to focus more is doing Automated Tests for JavaScript. Currently, all non-js code in Betfair passes through different kind of Automated (and Human) Testing (from Unit Testing, to Security, to Performance, to Human and Scripted QA), but the JavaScript language, by its very nature, makes it tricky to test in an automated fashion. It’s not impossible, just a bit harder than it should. A beautiful jasmine... Lately I have been spending a big chunk of my spare time lending a hand to the PhantomJS project, as some of you that know me might recall. Don’t break the flow That started because I saw in PhantomJS, and it’s headless nature, a great opportunity to contribute to the internal effort around JS Unit Testing. And because I wanted to allow both developers and CI-Servers to run JavaScript Tests with ease. I believe that if development experience it’s easy (and, I dare to say, FUN), code just flows! And if you can do testing with just one command from your CLI, the flow becomes almost beat. In Betfair we use Maven to drive our build system (yeah, I know, XML orgies are terrible…). So, we type a lot of:","headline":"Maven, PhantomJS and Jasmine to write your JS Unit Testing","mainEntityOfPage":{"@type":"WebPage","@id":"https://ivandemarino.me/2011/07/09/Maven-PhantomJS-and-Jasmine-to-write-your-JS-Unit-Testing"},"url":"https://ivandemarino.me/2011/07/09/Maven-PhantomJS-and-Jasmine-to-write-your-JS-Unit-Testing"}</script>
<!-- End Jekyll SEO tag -->

    </head>

    <body>
        <div id="layout" class="pure-g-r">

            <div id="sidebar" class="pure-u">
                <a id="toggle-navigation" href="#"><i class="icon-reorder"></i></a>

                <header id="header">

                    <hgroup>
                        <h1><a href="https://ivandemarino.me/">Too much <strong>coffee</strong><br/>too little <strong>time</strong></a></h1>
                        <h2>Ivan <strong>De Marino</strong></h2>
                    </hgroup>

                    <nav id="navigation">
                        
                            <ul id="internal-links">
                                
                                    <li class=""><a href="https://ivandemarino.me/">blog</a></li>
                                
                                    <li class=""><a href="https://ivandemarino.me/projects">projects</a></li>
                                
                                    <li class=""><a href="https://ivandemarino.me/about-me">about me</a></li>
                                
                                    <li class=""><a href="https://ivandemarino.me/archive">archive</a></li>
                                
                            </ul>
                        

                        
                            <ul id="rel-me-links">
                                
                                    <li><a rel="me" href="https://twitter.com/detronizator" target="_blank"><i class="icon-twitter"></i></a></li>
                                
                                    <li><a rel="me" href="https://github.com/detro" target="_blank"><i class="icon-github"></i></a></li>
                                
                                    <li><a rel="me" href="https://linkedin.com/in/ivandemarino" target="_blank"><i class="icon-linkedin"></i></a></li>
                                
                                    <li><a rel="me" href="https://ivandemarino.me/atom.xml" target="_blank"><i class="icon-rss"></i></a></li>
                                
                                    <li><a rel="me" href="https://ivandemarino.me/sitemap.xml" target="_blank"><i class="icon-sitemap"></i></a></li>
                                
                            </ul>
                        
                    </nav>

                </header>
            </div>

            <div id="main" class="pure-u-1">

                <div id="content">
                    
<article class="entry full pure-u-1">
    <header>
        <h1 class="title">
            
                Maven, PhantomJS and Jasmine to write your JS Unit Testing
            
        </h1>
        
            <ul class="meta">
                
                    <li>
                        <i class="icon-calendar"></i>
                        <time datetime="2011-07-08">Friday, 08 Jul 2011</time>
                    </li>
                

                
                    <li>
                        <i class="icon-tags"></i>
                        ci &bull; phantomjs &bull; jasmine &bull; unit testing &bull; maven &bull; jsunit
                    </li>
                

                
                    <li>
                        <i class="icon-time"></i>
                        1229 words
                    </li>
                
            </ul>
        
    </header>
    
        <div class="body">
            
                <p>In <a href="http://www.betfair.com">Betfair</a> we are building all sort of new things, and one of the aspects on which we are trying to focus more is doing Automated Tests for JavaScript.  Currently, all non-js code in Betfair passes through different kind of Automated (and Human) Testing (from Unit Testing, to Security, to Performance, to Human and Scripted QA), but the JavaScript language, by its very nature, makes it tricky to test in an automated fashion. It’s not impossible, just a bit harder than it should.</p>

<div class="img">
<img src="http://www.itmonline.org/jintu/image/jasmine.jpg" alt="A beautiful jasmine..." />
A beautiful jasmine...
</div>

<p>Lately I have been spending a big chunk of my spare time lending a hand to the <a href="http://www.phantomjs.org/">PhantomJS</a> project, as some of you that know me might recall.</p>

<h1 id="dont-break-the-flow">Don’t break the flow</h1>

<p>That started because I saw in PhantomJS, and it’s headless nature, a great opportunity to contribute to the internal effort around <strong>JS Unit Testing</strong>. And because I wanted to allow both developers and <a href="http://en.wikipedia.org/wiki/Continuous_integration">CI</a>-Servers to run JavaScript Tests with ease.</p>

<p>I believe that if <strong>development experience</strong> it’s easy (and, I dare to say, <strong>FUN</strong>), <em>code just flows</em>! And if you can do testing with just one command from your <a href="http://en.wikipedia.org/wiki/Command-line_interface">CLI</a>, the flow becomes almost <em>beat</em>.</p>

<p>In Betfair we use <a href="http://maven.apache.org/">Maven</a> to drive our build system (yeah, I know, XML orgies are terrible…). So, we type a lot of:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mvn clean <span class="nb">install</span>
</code></pre></div></div>

<p>even in departments where we mostly do Front End code. Ideally, we wanted to add, as a step to the build, a way to hook in the JavaScript Testing, and having the test result driving the build outcome.</p>

<p><strong><code class="language-plaintext highlighter-rouge">IF</code> JavaScript Test fails <code class="language-plaintext highlighter-rouge">THEN</code> Build Fails</strong>! Dead simple.</p>

<h1 id="jasmine-but-not-necessarily">Jasmine, but not necessarily</h1>

<p>There are multiple libraries to write <a href="http://www.google.co.uk/search?sourceid=chrome&amp;ie=UTF-8&amp;q=javascript+unit+testing">Unit Tests for JavaScript out there</a>, and we decided to go for <a href="http://pivotal.github.com/jasmine/">Jasmine</a>, the evolution of <a href="http://www.jsunit.net/">JSUnit</a> (now discontinued).</p>

<p>You can go for anything you want really, but in this post/example (and here in Betfair) we picked Jasmine. Feel free to choose your own library: as long as you are running in a browser, anything is good.</p>

<h1 id="setup">Setup</h1>

<p>To run the show, I came up with this setup: PhantomJS runs a script that runs a “jasmine-enabled” webpage. The script is then able to <strong>extract the result out of the webpage</strong> and save it on files. That’s how it looks like:</p>

<div class="img">
<img src="https://lh3.googleusercontent.com/-nJO__AXEdWQ/TvMHQ0agptI/AAAAAAAACUU/GPrj4MKuEUk/s800/PhantomJSJasmineXMLexamplesetup%252520%2525281%252529.png" width="700" />
</div>

<p>Yes, it’s a long chain of delegation. But it works. And it’s also “modular”: in case you want to run the tests in another Browser, you can just open the <code class="language-plaintext highlighter-rouge">".html"</code> runner! Or, in case you don’t want to use Maven, you can just invoke phantom and pass it the “jasmine xml runner script” (plus arguments).</p>

<h2 id="jasmine-reporters-forthewin">Jasmine reporters <code class="language-plaintext highlighter-rouge">#forthewin</code></h2>

<p>Jasmine has a very great <em>design feature</em>: <strong>Reporters</strong>. You can implement this kind of plugins to <em>attach</em> to Jasmine, separating the test execution from the test reporting. Based on the reporter you write, you can get any sort of output.</p>

<p>In our case, we need the tests to produce output in <a href="http://stackoverflow.com/questions/4922867/junit-xml-format-specification-that-hudson-supports/4925847#4925847">JUnit XML format</a>, and so I wrote one. But, if you know your shit, you are probably thinking:</p>
<blockquote>
&laquo;A web browser is sandboxed: how do your write a file with XML from there?&raquo;
</blockquote>
<p>Well, read on.</p>

<h2 id="jasmine-test_runnerhtml">Jasmine <code class="language-plaintext highlighter-rouge">test_runner.html</code></h2>

<p>As mentioned, Jasmine requires a webpage prepared to run the tests. In our case, something like the following is good:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>Jasmine Test Runner<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"lib/jasmine-1.0.2/jasmine.css"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"lib/jasmine-1.0.2/jasmine.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"lib/jasmine-1.0.2/jasmine-html.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"lib/jasmine-reporters/jasmine.phantomjs-reporter.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

  <span class="c">&lt;!-- include source files here... --&gt;</span>
  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"../src/tv.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

  <span class="c">&lt;!-- include spec files here... --&gt;</span>
  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"test_spec.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
  <span class="nx">jasmine</span><span class="p">.</span><span class="nf">getEnv</span><span class="p">().</span><span class="nf">addReporter</span><span class="p">(</span><span class="k">new</span> <span class="nx">jasmine</span><span class="p">.</span><span class="nc">TrivialReporter</span><span class="p">());</span>
  <span class="nx">jasmine</span><span class="p">.</span><span class="nf">getEnv</span><span class="p">().</span><span class="nf">addReporter</span><span class="p">(</span><span class="k">new</span> <span class="nx">jasmine</span><span class="p">.</span><span class="nc">PhantomJSReporter</span><span class="p">());</span>
  <span class="nx">jasmine</span><span class="p">.</span><span class="nf">getEnv</span><span class="p">().</span><span class="nf">execute</span><span class="p">();</span>
<span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<h2 id="how-phantomjs-does-the-trick">How PhantomJS does the trick</h2>

<p>PhantomJS, as you might know, allows to instantiate and manipulate webpages. And webpages are “sandboxed”: so, it’s not possible to write files on the filesystem from there. So, what I did 2 things:</p>

<ol>
  <li>Implemented a set of API for File I/O and submitted a pull request (see <code class="language-plaintext highlighter-rouge">fs</code> object in PhantomJS)</li>
  <li>Implemented a Jasmine Reporter that saves the output of the tests in isolated variables in the test runner page context (see <code class="language-plaintext highlighter-rouge">test/lib/jasmine-reporters/jasmine.phantomjs-reporter.js</code>)</li>
  <li>Wrote a PhantomJS script that is able to extract the test output from the webpage context and save it on filesystem (see <code class="language-plaintext highlighter-rouge">test/phantomjs_jasminexml_runner.js</code>)</li>
</ol>

<p>In this way it’s possible to preserve the sanboxing, while saving the desired XML format. And, along the way, give to PhantomJS the ability to manipulate files.</p>

<p>The script looks like this:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
    <span class="kd">var</span> <span class="nx">htmlrunner</span> <span class="o">=</span> <span class="nx">phantom</span><span class="p">.</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="nx">resultdir</span> <span class="o">=</span> <span class="nx">phantom</span><span class="p">.</span><span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="nx">page</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">WebPage</span><span class="p">();</span>
    
<span class="c1">// ...</span>

    <span class="nx">page</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="nx">htmlrunner</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">if </span><span class="p">(</span><span class="nx">status</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">success</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">utils</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nf">waitfor</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// wait for this to be true</span>
                <span class="k">return</span> <span class="nx">page</span><span class="p">.</span><span class="nf">evaluate</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nf">typeof</span><span class="p">(</span><span class="nx">jasmine</span><span class="p">.</span><span class="nx">phantomjsXMLReporterPassed</span><span class="p">)</span> <span class="o">!==</span> <span class="dl">"</span><span class="s2">undefined</span><span class="dl">"</span><span class="p">;</span>
                <span class="p">});</span>
            <span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// once done...</span>
                <span class="c1">// Retrieve the result of the tests</span>
                <span class="kd">var</span> <span class="nx">suitesResults</span> <span class="o">=</span> <span class="nx">page</span><span class="p">.</span><span class="nf">evaluate</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                    <span class="k">return</span> <span class="nx">jasmine</span><span class="p">.</span><span class="nx">phantomjsXMLReporterResults</span><span class="p">;</span>
                <span class="p">});</span>
                
                <span class="c1">// Save the result of the tests in files</span>
                <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                <span class="nf">for </span><span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">suitesResults</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="k">try</span> <span class="p">{</span>
                        <span class="nx">f</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="nx">resultdir</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">/</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">suitesResults</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="dl">"</span><span class="s2">xmlfilename</span><span class="dl">"</span><span class="p">],</span> <span class="dl">"</span><span class="s2">w</span><span class="dl">"</span><span class="p">);</span>
                        <span class="nx">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="nx">suitesResults</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="dl">"</span><span class="s2">xmlbody</span><span class="dl">"</span><span class="p">]);</span>
                        <span class="nx">f</span><span class="p">.</span><span class="nf">close</span><span class="p">();</span>
                    <span class="p">}</span> <span class="nf">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
                        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">phantomjs&gt; Unable to save result of Suite '</span><span class="dl">"</span><span class="o">+</span> <span class="nx">suitesResults</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="dl">"</span><span class="s2">xmlfilename</span><span class="dl">"</span><span class="p">]</span> <span class="o">+</span><span class="dl">"</span><span class="s2">'</span><span class="dl">"</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                
                <span class="c1">// Return the correct exit status. '0' only if all the tests passed</span>
                <span class="nx">phantom</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nf">evaluate</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                    <span class="k">return</span> <span class="nx">jasmine</span><span class="p">.</span><span class="nx">phantomjsXMLReporterPassed</span> <span class="p">?</span> <span class="mi">0</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//&lt; exit(0) is success, exit(1) is failure</span>
                <span class="p">}));</span>
            <span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// or, once it timesout...</span>
                <span class="nx">phantom</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">phantomjs&gt; Could not load '</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">htmlrunner</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">'.</span><span class="dl">"</span><span class="p">);</span>
            <span class="nx">phantom</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
</code></pre></div></div>

<p>Ah, the Filesystem API (i.e. the <code class="language-plaintext highlighter-rouge">fs.open()</code> above) are still <em>stabilising</em> as we are not sure yet how much of the <a href="http://wiki.commonjs.org/wiki/Filesystem">CommonJS/Filesystem</a> specs we want to implement in PhantomJS. If you care about PhantomJS, contribute to the discussion <a href="https://groups.google.com/d/topic/phantomjs/Z4E3cD3IJIM/discussion">here</a>.</p>

<h2 id="oh-yes-maven">Oh, yes, Maven</h2>

<p>Some of you might have reached this page for Maven. Let me say, I’m sorry you have to deal with that thing, but… let’s just focus.</p>

<p>Maven has a plugin for running external executable: <code class="language-plaintext highlighter-rouge">exec-maven-plugin</code>. It allows to launch any executable and, in case this exit failing (i.e. <code class="language-plaintext highlighter-rouge">exit(1);</code> or <code class="language-plaintext highlighter-rouge">exit(EXIT_FAILURE);</code>), fail the build. Super!</p>

<p>So, how it looks like?</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0
    http://maven.apache.org/maven-v4_0_0.xsd"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.codehaus.mojo<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>exec-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>1.1<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;executions&gt;</span>
                    <span class="nt">&lt;execution&gt;</span>
                        <span class="nt">&lt;id&gt;</span>PhantomJS Unit Testing<span class="nt">&lt;/id&gt;</span>
                        <span class="nt">&lt;phase&gt;</span>test<span class="nt">&lt;/phase&gt;</span>
                        <span class="nt">&lt;goals&gt;</span>
                            <span class="nt">&lt;goal&gt;</span>exec<span class="nt">&lt;/goal&gt;</span>
                        <span class="nt">&lt;/goals&gt;</span>
                    <span class="nt">&lt;/execution&gt;</span>
                <span class="nt">&lt;/executions&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;executable&gt;</span>phantomjs<span class="nt">&lt;/executable&gt;</span>
                    <span class="nt">&lt;workingDirectory&gt;</span>test<span class="nt">&lt;/workingDirectory&gt;</span>
                    <span class="nt">&lt;arguments&gt;</span>
                        <span class="nt">&lt;argument&gt;</span>phantomjs_jasminexml_runner.js<span class="nt">&lt;/argument&gt;</span>
                        <span class="nt">&lt;argument&gt;</span>test_runner.html<span class="nt">&lt;/argument&gt;</span>
                        <span class="nt">&lt;argument&gt;</span>${project.build.directory}/surefire-reports<span class="nt">&lt;/argument&gt;</span>
                    <span class="nt">&lt;/arguments&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div>

<p>This adds a step in the <code class="language-plaintext highlighter-rouge">test phase</code> of the build, running our tests.</p>

<h1 id="its-on-github">It’s on GitHub</h1>

<p>As every piece of code that a) I think it’s of any value, and b) that I can share, it’s on GitHub: <a href="https://github.com/detro/phantomjs-jasminexml-example">phantom-jasminexml-example</a>. As the name says, this is just an example. An <em>inspiration</em>. Please customise it as much as you want to fit your purposes. And in case you can, contribute a patch to make it better.</p>

<h1 id="conclusion">Conclusion</h1>

<p>This just started. My experience in JavaScript Unit Testing is not very good, and I’m learning in the process. So, chances are, this solution has a lot of problems, it’s rubbish and needs rewrite.</p>

<p>If that’s the case, please post a comment with your thoughts and, possibly, suggestions on how this can be improved. For example, it would be great if <code class="language-plaintext highlighter-rouge">phantomjs_jasminexml_runner.js</code> was able to <strong>generate the <code class="language-plaintext highlighter-rouge">test_runner.html</code> automagically</strong>, after having scanned a directory containing test specs.</p>

<h1 id="pr-time">PR time</h1>

<p>By the way, if you eat code for breakfast, and you are proud of it, <a href="http://jobvite.com/m?37Sa6fwZ">we are hiring</a>: you might join us in trying to build this new piece of the puzzle for Betfair.</p>

            
        </div>
    
</article>


                </div>

                <footer id="footer">
                    
                        <span>Hosted on <a href="http://pages.github.com/" target="_blank">GitHub Pages</a></span>
                    
                    
                        <span>Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a></span>
                    
                    
                    
                        <span>Licensed under <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0</a></span>
                    
                </footer>

            </div>
        </div>

        <script>
            // Registering "click" handler for "#toggle-navigation"
            normalize.elementAddEventListener(document.getElementById("toggle-navigation"),
                "click",
                function(e) {
                    var navEl = document.getElementById("navigation");
                    navEl.classList.toggle("open");
                    e.preventDefault();
                });
        </script>
    </body>
</html>
