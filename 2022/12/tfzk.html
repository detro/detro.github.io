<!DOCTYPE html>
<html>
    <head>
        <link rel="icon" href="/favicon.ico" type="image/x-icon">
        <link type="application/atom+xml" rel="alternate" href="https://ivandemarino.me/atom.xml" title="Too much coffee, too little time" />

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

        <!-- Third Party CSS -->
        <link href="/css/thirdparty/purecss-combo.min.css" rel="stylesheet">
        <link href="/css/thirdparty/font-awesome/css/font-awesome.min.css" rel="stylesheet">
        <!--[if IE 7]>
            <link href="/css/thirdparty/font-awesome/css/font-awesome-ie7.min.css" rel="stylesheet" >
        <![endif]-->

        <!-- Theme CSS -->
        <link rel="stylesheet" href="/css/leo.css">

        <!-- Utility JS -->
        <script type="text/javascript" src="/js/normalize.js"></script>

        
            <script async src="https://www.googletagmanager.com/gtag/js?id=UA-136869-11"></script>
            <script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());

              gtag('config', 'UA-136869-11');
            </script>
        

        
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-K0JQTBH0J9"></script>
            <script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());

              gtag('config', 'G-K0JQTBH0J9');
            </script>
        

        <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>TFZK - A Terraform Provider for Apache ZooKeeper | Too much coffee, too little time</title>
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="TFZK - A Terraform Provider for Apache ZooKeeper" />
<meta name="author" content="Ivan De Marino" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Gimme the TL;DR" />
<meta property="og:description" content="Gimme the TL;DR" />
<link rel="canonical" href="https://ivandemarino.me/2022/12/tfzk" />
<meta property="og:url" content="https://ivandemarino.me/2022/12/tfzk" />
<meta property="og:site_name" content="Too much coffee, too little time" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-12-02T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="TFZK - A Terraform Provider for Apache ZooKeeper" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Ivan De Marino"},"dateModified":"2022-12-02T00:00:00+00:00","datePublished":"2022-12-02T00:00:00+00:00","description":"Gimme the TL;DR","headline":"TFZK - A Terraform Provider for Apache ZooKeeper","mainEntityOfPage":{"@type":"WebPage","@id":"https://ivandemarino.me/2022/12/tfzk"},"url":"https://ivandemarino.me/2022/12/tfzk"}</script>
<!-- End Jekyll SEO tag -->

    </head>

    <body>
        <div id="layout" class="pure-g-r">

            <div id="sidebar" class="pure-u">
                <a id="toggle-navigation" href="#"><i class="icon-reorder"></i></a>

                <header id="header">

                    <hgroup>
                        <h1><a href="https://ivandemarino.me/">Too much <strong>coffee</strong><br/>too little <strong>time</strong></a></h1>
                        <h2>Ivan <strong>De Marino</strong></h2>
                    </hgroup>

                    <nav id="navigation">
                        
                            <ul id="internal-links">
                                
                                    <li class=""><a href="https://ivandemarino.me/">blog</a></li>
                                
                                    <li class=""><a href="https://ivandemarino.me/projects">projects</a></li>
                                
                                    <li class=""><a href="https://ivandemarino.me/about-me">about me</a></li>
                                
                                    <li class=""><a href="https://ivandemarino.me/archive">archive</a></li>
                                
                            </ul>
                        

                        
                            <ul id="rel-me-links">
                                
                                    <li><a rel="me" href="https://twitter.com/detronizator" target="_blank"><i class="icon-twitter"></i></a></li>
                                
                                    <li><a rel="me" href="https://github.com/detro" target="_blank"><i class="icon-github"></i></a></li>
                                
                                    <li><a rel="me" href="https://linkedin.com/in/ivandemarino" target="_blank"><i class="icon-linkedin"></i></a></li>
                                
                                    <li><a rel="me" href="https://ivandemarino.me/atom.xml" target="_blank"><i class="icon-rss"></i></a></li>
                                
                                    <li><a rel="me" href="https://ivandemarino.me/sitemap.xml" target="_blank"><i class="icon-sitemap"></i></a></li>
                                
                            </ul>
                        
                    </nav>

                </header>
            </div>

            <div id="main" class="pure-u-1">

                <div id="content">
                    
<article class="entry full pure-u-1">
    <header>
        <h1 class="title">
            
                TFZK - A Terraform Provider for Apache ZooKeeper
            
        </h1>
        
            <ul class="meta">
                
                    <li>
                        <i class="icon-calendar"></i>
                        <time datetime="2022-12-02">Friday, 02 Dec 2022</time>
                    </li>
                

                
                    <li>
                        <i class="icon-tags"></i>
                        tfzk &bull; terraform &bull; zookeeper &bull; apache &bull; opensource &bull; project
                    </li>
                

                
                    <li>
                        <i class="icon-time"></i>
                        715 words
                    </li>
                
            </ul>
        
    </header>
    
        <div class="body">
            
                <h2 id="gimme-the-tldr">Gimme the TL;DR</h2>

<p>A new Terraform provider is available, designed to interact with ZooKeeper ZNodes:
<a href="https://registry.terraform.io/providers/tfzk/zookeeper/latest">TFZK</a>.
The latest stable version is <code class="language-plaintext highlighter-rouge">v1.0.3</code>, and you should give it a go.</p>

<p>Ah! And <a href="https://registry.terraform.io/providers/tfzk/zookeeper/latest/docs">here is the doc</a>.</p>

<h2 id="ok-i-got-more-time---go-ahead">OK, I got more time - go ahead!</h2>

<p>Earlier this year I decided to scratch a long-standing itch: build a
<a href="https://developer.hashicorp.com/terraform/language/providers">Terraform Provider</a>
for <a href="https://zookeeper.apache.org/">Apache ZooKeeper</a>. While there was already
<a href="https://registry.terraform.io/providers/ContentSquare/zookeeper/latest">one</a>,
it came with limitations that created issues in production environments:</p>

<ul>
  <li>only supported connecting to a <em>single</em> ensemble member</li>
  <li>no support for storing binary data</li>
  <li>no access to the <a href="https://zookeeper.apache.org/doc/current/zookeeperProgrammers.html#sc_zkStatStructure">ZNode Stat Structure</a></li>
  <li>no support for <a href="https://zookeeper.apache.org/doc/r3.1.2/zookeeperProgrammers.html#Sequence+Nodes+--+Unique+Naming"><code class="language-plaintext highlighter-rouge">PERSISTENT_SEQUENTIAL</code> ZNodes</a></li>
</ul>

<p>Enter <a href="https://registry.terraform.io/providers/tfzk/zookeeper/latest">Terraform Provider ZooKeeper (TFZK)</a>
(<a href="https://github.com/tfzk/terraform-provider-zookeeper">GitHub repo</a>).</p>

<p><img src="/img/tfzk-logo.png" alt="tfzk logo" /></p>

<h2 id="wait-whats-zookeeper">Wait! What’s ZooKeeper?</h2>

<p>From <a href="https://zookeeper.apache.org/doc/current/index.html">here</a>:</p>

<blockquote>
  <p>ZooKeeper is a high-performance coordination service for distributed applications.
It exposes common services - such as naming, configuration management,
synchronization, and group services - in a simple interface so you don’t have
to write them from scratch. You can use it off-the-shelf to implement consensus,
group management, leader election, and presence protocols.</p>
</blockquote>

<h2 id="what-does-zookeeper-have-to-do-with-terraform">What does ZooKeeper have to do with Terraform?</h2>

<p>Good question.</p>

<p><a href="https://developer.hashicorp.com/terraform/intro">Terraform</a> is a <em>de-facto</em>
industry standard for managing small, medium and even large infrastructure in a
declarative manner. In a <em>cloud world</em>, <strong>Terraform is a tool to bring order to chaos</strong>.</p>

<p>Build a large enough infrastructure, and you will need to come up with ways to
dynamically distribute configuration to running systems. Say, you need a way
to inform your 
<em><a href="https://www.sciencedirect.com/topics/computer-science/sharding">sharded</a> cloud infrastructure</em>
of things like:</p>

<ul>
  <li>which shard is in charge of what incoming traffic</li>
  <li>how services running in one shard, can send data to another one</li>
  <li>a new shard was deployed</li>
  <li>an existing shard was retired/drained</li>
</ul>

<p>You could, in theory, provide your <em>topology</em> to every service, via startup-time configuration.
But that comes with a non-zero downtime: you need to modify and distribute the
configuration, and then restart your services to read it. Not ideal for your uptime.</p>

<p>That’s where a service like ZooKeeper shines: it’s not designed for
high throughput or for storing lots of data. But to be a reliable central place
to send services to, so they can coordinate and react to larger infrastructure changes.</p>

<p>So, to answer your question, <em>what does ZooKeeper have to do with Terraform?</em>
ZooKeeper can be a perfect place to store a <em>live</em> picture of your
infrastructure reality and let services rely on it to listen for changes.</p>

<h2 id="so-what-can-i-do-with-this-provider">So, what can I do with this provider?</h2>

<p>ZooKeeper can do a lot of things, but all are built around the core concept
of <a href="https://zookeeper.apache.org/doc/current/zookeeperProgrammers.html#sc_zkDataModel_znodes">ZNode</a>:</p>

<blockquote>
  <p>Every node in a ZooKeeper tree is referred to as a znode.
Znodes maintain a stat structure that includes version numbers for data changes,
acl changes. The stat structure also has timestamps.
The version number, together with the timestamp, allows ZooKeeper to validate
the cache and coordinate updates.
Each time a znode’s data changes, the version number increases.
For instance, whenever a client retrieves data, it also receives the version of the data.</p>
</blockquote>

<p>TFZK offers a ZNode <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a>:</p>

<ul>
  <li>A Persistent ZNodes resource: <a href="https://registry.terraform.io/providers/tfzk/zookeeper/latest/docs/resources/znode"><code class="language-plaintext highlighter-rouge">zookeeper_znode</code></a></li>
  <li>A Persistent Sequential ZNodes resource: <a href="https://registry.terraform.io/providers/tfzk/zookeeper/latest/docs/resources/sequential_znode"><code class="language-plaintext highlighter-rouge">zookeeper_sequential_znode</code></a></li>
  <li>A ZNode data source: <a href="https://registry.terraform.io/providers/tfzk/zookeeper/latest/docs/data-sources/znode"><code class="language-plaintext highlighter-rouge">zookeeper_znode</code></a></li>
  <li>Support for <a href="https://registry.terraform.io/providers/tfzk/zookeeper/latest/docs#servers">connecting the provider to all servers</a> in the Ensemble</li>
  <li>Configurable <a href="https://registry.terraform.io/providers/tfzk/zookeeper/latest/docs#zookeeper-sessions">sessions time-out</a></li>
  <li>Full access to the ZNodes <a href="https://registry.terraform.io/providers/tfzk/zookeeper/latest/docs#the-stat-structure">Stat Structure</a></li>
</ul>

<p>Given that a Terraform Provider only “runs” during your <code class="language-plaintext highlighter-rouge">plan</code>s and <code class="language-plaintext highlighter-rouge">apply</code>s,
its focus is on Persistent ZNodes. For this reason, it can’t support 
Ephemeral ZNodes, Watchers and other “live” features, that are built
for services that hold a persistent connection:
those are more targeted at runtime services and applications (i.e. your code).</p>

<h2 id="ok-im-sold-how-do-i-get-started">OK, I’m sold. How do I get started?</h2>

<p>At the time I’m writing this, <a href="https://registry.terraform.io/providers/tfzk/zookeeper/1.0.3"><code class="language-plaintext highlighter-rouge">v1.0.3</code></a>
is out. Start by adding to your Terraform configuration:</p>

<div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">zookeeper</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"tfzk/zookeeper"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"1.0.3"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">provider</span> <span class="s2">"zookeeper"</span> <span class="p">{</span>
  <span class="c1"># Configuration options</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And then head to the
<a href="https://registry.terraform.io/providers/tfzk/zookeeper/latest/docs">official documentation</a>.</p>

<h2 id="its-great-but-its-missing-feature-x">It’s great, but it’s missing feature X!</h2>

<p>Great, <a href="https://github.com/tfzk/terraform-provider-zookeeper#development">why don’t you help me?</a>
I set it up so it should be easy to set up a local dev environment, where you
can spin up an ensemble to test against.</p>

<p>There are especially 2 <a href="https://github.com/tfzk/terraform-provider-zookeeper#provider-features">features</a>
I’d like to see implemented:</p>

<ul>
  <li>Support for full authentication</li>
  <li>Support for ACLs</li>
</ul>

<p>And if you are new to Terraform Provider development, take a look at
<a href="https://developer.hashicorp.com/terraform/tutorials/providers/provider-use">this amazing tutorial</a>.
That’s how I got started.</p>

            
        </div>
    
</article>


                </div>

                <footer id="footer">
                    
                        <span>Hosted on <a href="http://pages.github.com/" target="_blank">GitHub Pages</a></span>
                    
                    
                        <span>Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a></span>
                    
                    
                    
                        <span>Licensed under <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0</a></span>
                    
                </footer>

            </div>
        </div>

        <script>
            // Registering "click" handler for "#toggle-navigation"
            normalize.elementAddEventListener(document.getElementById("toggle-navigation"),
                "click",
                function(e) {
                    var navEl = document.getElementById("navigation");
                    navEl.classList.toggle("open");
                    e.preventDefault();
                });
        </script>
    </body>
</html>
