<!DOCTYPE html>
<html>
    <head>
        <link rel="icon" href="/favicon.ico" type="image/x-icon">
        <link type="application/atom+xml" rel="alternate" href="https://ivandemarino.me/atom.xml" title="Too much coffee, too little time" />

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

        <!-- Third Party CSS -->
        <link href="/css/thirdparty/purecss-combo.min.css" rel="stylesheet">
        <link href="/css/thirdparty/font-awesome/css/font-awesome.min.css" rel="stylesheet">
        <!--[if IE 7]>
            <link href="/css/thirdparty/font-awesome/css/font-awesome-ie7.min.css" rel="stylesheet" >
        <![endif]-->

        <!-- Theme CSS -->
        <link rel="stylesheet" href="/css/leo.css">

        <!-- Utility JS -->
        <script type="text/javascript" src="/js/normalize.js"></script>

        
            <script async src="https://www.googletagmanager.com/gtag/js?id=UA-136869-11"></script>
            <script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());

              gtag('config', 'UA-136869-11');
            </script>
        

        
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-K0JQTBH0J9"></script>
            <script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());

              gtag('config', 'G-K0JQTBH0J9');
            </script>
        

        <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Minification and Templating for Bloggart | Too much coffee, too little time</title>
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="Minification and Templating for Bloggart" />
<meta name="author" content="detro" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I’m sick home, but I can’t just sit in bed. It’s not how I work: I need to do something. So, I decided to give some love to Bloggart and put into proper code some features I already said I wanted to add. I just committed on my Bloggart fork quite a list of things: Support for JS and CSS ‘Minification’ (no obfuscation though) Support for JS and CSS ‘Templating’ (i.e. Being able to use App Engine Djiango Template grammar into JS and CSS files) Support for JS and CSS ‘Memcaching’ Show line numbers for ‘&lt;pre&gt;sourcecode&lt;/pre&gt;’ areas in posts Even though this is simple stuff, two of them stand out I think: Minification and Templating. Why? Because even if those are not complex or new, they speed Bloggart up even more! Let me spend a couple of words on it, so that it can be useful for you, even if you are not planning to use Bloggart. How I implemented Minification and Templating in Bloggart The magic is made of 3 parts. First, a new URL handler in the app.yaml file:" />
<meta property="og:description" content="I’m sick home, but I can’t just sit in bed. It’s not how I work: I need to do something. So, I decided to give some love to Bloggart and put into proper code some features I already said I wanted to add. I just committed on my Bloggart fork quite a list of things: Support for JS and CSS ‘Minification’ (no obfuscation though) Support for JS and CSS ‘Templating’ (i.e. Being able to use App Engine Djiango Template grammar into JS and CSS files) Support for JS and CSS ‘Memcaching’ Show line numbers for ‘&lt;pre&gt;sourcecode&lt;/pre&gt;’ areas in posts Even though this is simple stuff, two of them stand out I think: Minification and Templating. Why? Because even if those are not complex or new, they speed Bloggart up even more! Let me spend a couple of words on it, so that it can be useful for you, even if you are not planning to use Bloggart. How I implemented Minification and Templating in Bloggart The magic is made of 3 parts. First, a new URL handler in the app.yaml file:" />
<link rel="canonical" href="https://ivandemarino.me/2010/11/26/Minification-and-Templating-for-Bloggart" />
<meta property="og:url" content="https://ivandemarino.me/2010/11/26/Minification-and-Templating-for-Bloggart" />
<meta property="og:site_name" content="Too much coffee, too little time" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2010-11-26T15:47:53+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Minification and Templating for Bloggart" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"detro"},"dateModified":"2010-11-26T15:47:53+00:00","datePublished":"2010-11-26T15:47:53+00:00","description":"I’m sick home, but I can’t just sit in bed. It’s not how I work: I need to do something. So, I decided to give some love to Bloggart and put into proper code some features I already said I wanted to add. I just committed on my Bloggart fork quite a list of things: Support for JS and CSS ‘Minification’ (no obfuscation though) Support for JS and CSS ‘Templating’ (i.e. Being able to use App Engine Djiango Template grammar into JS and CSS files) Support for JS and CSS ‘Memcaching’ Show line numbers for ‘&lt;pre&gt;sourcecode&lt;/pre&gt;’ areas in posts Even though this is simple stuff, two of them stand out I think: Minification and Templating. Why? Because even if those are not complex or new, they speed Bloggart up even more! Let me spend a couple of words on it, so that it can be useful for you, even if you are not planning to use Bloggart. How I implemented Minification and Templating in Bloggart The magic is made of 3 parts. First, a new URL handler in the app.yaml file:","headline":"Minification and Templating for Bloggart","mainEntityOfPage":{"@type":"WebPage","@id":"https://ivandemarino.me/2010/11/26/Minification-and-Templating-for-Bloggart"},"url":"https://ivandemarino.me/2010/11/26/Minification-and-Templating-for-Bloggart"}</script>
<!-- End Jekyll SEO tag -->

    </head>

    <body>
        <div id="layout" class="pure-g-r">

            <div id="sidebar" class="pure-u">
                <a id="toggle-navigation" href="#"><i class="icon-reorder"></i></a>

                <header id="header">

                    <hgroup>
                        <h1><a href="https://ivandemarino.me/">Too much <strong>coffee</strong><br/>too little <strong>time</strong></a></h1>
                        <h2>Ivan <strong>De Marino</strong></h2>
                    </hgroup>

                    <nav id="navigation">
                        
                            <ul id="internal-links">
                                
                                    <li class=""><a href="https://ivandemarino.me/">blog</a></li>
                                
                                    <li class=""><a href="https://ivandemarino.me/projects">projects</a></li>
                                
                                    <li class=""><a href="https://ivandemarino.me/about-me">about me</a></li>
                                
                                    <li class=""><a href="https://ivandemarino.me/archive">archive</a></li>
                                
                            </ul>
                        

                        
                            <ul id="rel-me-links">
                                
                                    <li><a rel="me" href="https://twitter.com/detronizator" target="_blank"><i class="icon-twitter"></i></a></li>
                                
                                    <li><a rel="me" href="https://github.com/detro" target="_blank"><i class="icon-github"></i></a></li>
                                
                                    <li><a rel="me" href="https://linkedin.com/in/ivandemarino" target="_blank"><i class="icon-linkedin"></i></a></li>
                                
                                    <li><a rel="me" href="https://ivandemarino.me/atom.xml" target="_blank"><i class="icon-rss"></i></a></li>
                                
                                    <li><a rel="me" href="https://ivandemarino.me/sitemap.xml" target="_blank"><i class="icon-sitemap"></i></a></li>
                                
                            </ul>
                        
                    </nav>

                </header>
            </div>

            <div id="main" class="pure-u-1">

                <div id="content">
                    
<article class="entry full pure-u-1">
    <header>
        <h1 class="title">
            
                Minification and Templating for Bloggart
            
        </h1>
        
            <ul class="meta">
                
                    <li>
                        <i class="icon-calendar"></i>
                        <time datetime="2010-11-26">Friday, 26 Nov 2010</time>
                    </li>
                

                
                    <li>
                        <i class="icon-tags"></i>
                        fork &bull; minification &bull; github &bull; features &bull; blog &bull; line numbers &bull; new &bull; commit &bull; bloggart &bull; templating
                    </li>
                

                
                    <li>
                        <i class="icon-time"></i>
                        461 words
                    </li>
                
            </ul>
        
    </header>
    
        <div class="body">
            
                <p>I’m sick home, but I can’t just sit in bed. It’s not how I work: I need to do something. So, I decided to give some love to Bloggart and put into proper code some features <a href="http://blog.ivandemarino.me/2010/11/25/Too-busy-to-blog">I already said</a> I wanted to add.</p>

<div style="text-align: center; margin: 10px;" class="img">
<img src="http://www.greatescapecars.co.uk/images/library/images/Mini01.JPG" />
</div>

<p>I just committed on <a href="https://github.com/detro/bloggart/commits/master">my Bloggart fork</a> quite a list of things:</p>

<ul>
  <li>Support for JS and CSS ‘Minification’ (no obfuscation though)</li>
  <li>Support for JS and CSS ‘Templating’ (i.e. Being able to use App Engine Djiango Template grammar into JS and CSS files)</li>
  <li>Support for JS and CSS ‘Memcaching’</li>
  <li>Show line numbers for ‘&lt;pre&gt;sourcecode&lt;/pre&gt;’ areas in posts</li>
</ul>

<p>Even though this is simple stuff, two of them stand out I think: <strong>Minification and Templating</strong>. Why? Because even if those are not complex or new, they speed Bloggart up even more! Let me spend a couple of words on it, so that it can be useful for you, even if you are not planning to use Bloggart.</p>

<h3 id="how-i-implemented-minification-and-templating-in-bloggart">How I implemented Minification and Templating in Bloggart</h3>

<p>The magic is made of 3 parts. First, a new URL handler in the <a href="https://github.com/detro/bloggart/blob/master/app.yaml">app.yaml</a> file:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...</span>
<span class="pi">-</span> <span class="na">url</span><span class="pi">:</span> <span class="s">/.*\.(css|js)</span>
  <span class="na">script</span><span class="pi">:</span> <span class="s">minifier.py</span>

<span class="pi">-</span> <span class="na">url</span><span class="pi">:</span> <span class="s">/static/([^/]+)/(.*)</span>
  <span class="na">static_files</span><span class="pi">:</span> <span class="s">themes/\1/static/\2</span>
  <span class="na">upload</span><span class="pi">:</span> <span class="s">themes/[^/]+/static/.*</span>
<span class="c1"># ...</span>
</code></pre></div></div>

<p>This routes requests to CSS and JS files to a new Request Handler, <a href="https://github.com/detro/bloggart/blob/master/minifier.py">minifier.py</a>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span><span class="k">class</span> <span class="nc">CssMinifier</span><span class="p">(</span> <span class="n">webapp</span><span class="p">.</span><span class="n">RequestHandler</span> <span class="p">):</span>      
   <span class="k">def</span> <span class="nf">get</span><span class="p">(</span> <span class="n">self</span><span class="p">,</span> <span class="n">requestedCssFilename</span> <span class="p">):</span>
      <span class="n">cssPath</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">dirname</span><span class="p">(</span> <span class="n">__file__</span> <span class="p">),</span> <span class="sh">'</span><span class="s">themes/%s/%s</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">theme</span><span class="p">,</span> <span class="n">requestedCssFilename</span><span class="p">)</span> <span class="p">);</span>
      <span class="nf">if </span><span class="p">(</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">cssPath</span><span class="p">)</span> <span class="p">):</span>
         <span class="n">util</span><span class="p">.</span><span class="nf">setErrorResponse</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="mi">404</span><span class="p">);</span>
         <span class="k">return</span><span class="p">;</span>
      
      <span class="n">cssRenderingResult</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
      <span class="nf">if </span><span class="p">(</span> <span class="n">config</span><span class="p">.</span><span class="n">memcaching</span> <span class="p">):</span>
         <span class="n">cssRenderingResult</span> <span class="o">=</span> <span class="n">memcache</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">cssPath</span><span class="p">);</span>
      
      <span class="nf">if </span><span class="p">(</span> <span class="n">cssRenderingResult</span> <span class="ow">is</span> <span class="bp">None</span> <span class="p">):</span>      
         <span class="n">cssRenderingResult</span> <span class="o">=</span> <span class="n">template</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="n">cssPath</span><span class="p">,</span> <span class="p">{</span> <span class="sh">'</span><span class="s">config</span><span class="sh">'</span> <span class="p">:</span> <span class="n">config</span> <span class="p">});</span>

         <span class="nf">if </span><span class="p">(</span> <span class="n">config</span><span class="p">.</span><span class="n">logging_level</span> <span class="o">!=</span> <span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span> <span class="p">):</span>
            <span class="n">cssRenderingResult</span> <span class="o">=</span> <span class="n">cssmin</span><span class="p">.</span><span class="nf">minify</span><span class="p">(</span><span class="n">cssRenderingResult</span><span class="p">);</span>
         
         <span class="n">memcache</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="n">cssPath</span><span class="p">,</span> <span class="n">cssRenderingResult</span><span class="p">);</span>
         
      <span class="n">self</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="sh">'</span><span class="s">Content-Type</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">text/css</span><span class="sh">'</span>
      <span class="n">self</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span> <span class="n">cssRenderingResult</span> <span class="p">);</span>

<span class="k">class</span> <span class="nc">JSMinifier</span><span class="p">(</span> <span class="n">webapp</span><span class="p">.</span><span class="n">RequestHandler</span> <span class="p">):</span>      
   <span class="k">def</span> <span class="nf">get</span><span class="p">(</span> <span class="n">self</span><span class="p">,</span> <span class="n">requestedJsFilename</span> <span class="p">):</span>
      <span class="n">jsPath</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">dirname</span><span class="p">(</span> <span class="n">__file__</span> <span class="p">),</span> <span class="sh">'</span><span class="s">themes/%s/%s</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">theme</span><span class="p">,</span> <span class="n">requestedJsFilename</span><span class="p">)</span> <span class="p">);</span>
      <span class="nf">if </span><span class="p">(</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">jsPath</span><span class="p">)</span> <span class="p">):</span>
         <span class="n">util</span><span class="p">.</span><span class="nf">setErrorResponse</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="mi">404</span><span class="p">);</span>
         <span class="k">return</span><span class="p">;</span>
      
      <span class="n">jsRenderingResult</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
      <span class="nf">if </span><span class="p">(</span> <span class="n">config</span><span class="p">.</span><span class="n">memcaching</span> <span class="p">):</span>
         <span class="n">jsRenderingResult</span> <span class="o">=</span> <span class="n">memcache</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">jsPath</span><span class="p">);</span>
      
      <span class="nf">if </span><span class="p">(</span> <span class="n">jsRenderingResult</span> <span class="ow">is</span> <span class="bp">None</span> <span class="p">):</span>         
         <span class="n">jsRenderingResult</span> <span class="o">=</span> <span class="n">template</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="n">jsPath</span><span class="p">,</span> <span class="p">{</span> <span class="sh">'</span><span class="s">config</span><span class="sh">'</span> <span class="p">:</span> <span class="n">config</span> <span class="p">});</span>

         <span class="nf">if </span><span class="p">(</span> <span class="n">config</span><span class="p">.</span><span class="n">logging_level</span> <span class="o">!=</span> <span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span> <span class="p">):</span>
            <span class="n">jsRenderingResult</span> <span class="o">=</span> <span class="n">jsmin</span><span class="p">.</span><span class="nf">jsmin</span><span class="p">(</span><span class="n">jsRenderingResult</span><span class="p">);</span>
         
         <span class="n">memcache</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="n">jsPath</span><span class="p">,</span> <span class="n">jsRenderingResult</span><span class="p">);</span>
         
      <span class="n">self</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="sh">'</span><span class="s">Content-Type</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">application/javascript</span><span class="sh">'</span>
      <span class="n">self</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span> <span class="n">jsRenderingResult</span> <span class="p">);</span>

<span class="n">application</span> <span class="o">=</span> <span class="n">webapp</span><span class="p">.</span><span class="nc">WSGIApplication</span><span class="p">([</span>
                                      <span class="p">(</span> <span class="sh">'</span><span class="s">(/.*\.js)$</span><span class="sh">'</span><span class="p">,</span> <span class="n">JSMinifier</span> <span class="p">),</span>
                                      <span class="p">(</span> <span class="sh">'</span><span class="s">(/.*\.css)$</span><span class="sh">'</span><span class="p">,</span> <span class="n">CssMinifier</span> <span class="p">)</span>
                                      <span class="p">],</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span> <span class="p">)</span>
<span class="c1"># ...
</span></code></pre></div></div>

<p>The minification is done using a couple of libraries that I’ll mention in a second. Templating is transparently applied <strong>BEFORE Minification</strong>, so that the Theme developer (me most probably) can use code like the following to Bundle JS and CSS in as less HTTP Requests as possible:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/* CSS code... */
{ % include "another_file.css" % }
/* more CSS code */
</code></pre></div></div>

<p>The actual business logic for the minification is done by <a href="https://github.com/detro/bloggart/blob/master/lib/cssmin.py">lib/cssmin.py</a> and <a href="https://github.com/detro/bloggart/blob/master/lib/jsmin.py">lib/jsmin.py from Douglas Crockford</a>.</p>

<p>If you are a Python App Engine developer, I hope you find useful this _simple-yet-effectiv_e technique.</p>


            
        </div>
    
</article>


                </div>

                <footer id="footer">
                    
                        <span>Hosted on <a href="http://pages.github.com/" target="_blank">GitHub Pages</a></span>
                    
                    
                        <span>Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a></span>
                    
                    
                    
                        <span>Licensed under <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0</a></span>
                    
                </footer>

            </div>
        </div>

        <script>
            // Registering "click" handler for "#toggle-navigation"
            normalize.elementAddEventListener(document.getElementById("toggle-navigation"),
                "click",
                function(e) {
                    var navEl = document.getElementById("navigation");
                    navEl.classList.toggle("open");
                    e.preventDefault();
                });
        </script>
    </body>
</html>
