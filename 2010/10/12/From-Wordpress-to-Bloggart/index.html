<!DOCTYPE html>
<html>
    <head>
        <title>From Wordpress to Bloggart</title>

        <meta name="author" content="Ivan De Marino">
        <meta name="generator" content="Jekyll"
        <link rel="icon" href="favicon.ico" type="image/x-icon">

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

        <link href="http://yui.yahooapis.com/combo?pure/0.3.0/base-min.css&pure/0.3.0/grids-min.css&pure/0.3.0/forms-min.css&pure/0.3.0/buttons-min.css&pure/0.3.0/menus-min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css" rel="stylesheet">
        <!--[if IE 7]>
            <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome-ie7.min.css" rel="stylesheet" >
        <![endif]-->

        <link rel="stylesheet" href="/css/leo.css">
    </head>

    <body>
        <div id="layout" class="pure-g-r">

            <div id="sidebar" class="pure-u">
                <a id="toggle-blog-navigation" href="#"><i class="icon-reorder"></i></a>

                <header id="blog-header">

                    <hgroup>
                        <h1><a href="/">Too much Coffee,<br/>too little Time</a></h1>
                        <h2>Ivan De Marino</h2>
                    </hgroup>

                    <nav id="blog-navigation">
                        
                            <ul id="blog-internal-links">
                                
                                    <li class="current"><a href="/">blog</a></li>
                                
                                    <li class=""><a href="/projects">projects</a></li>
                                
                                    <li class=""><a href="/about-me">about me</a></li>
                                
                                    <li class=""><a href="/archive">archive</a></li>
                                
                            </ul>
                        

                        
                            <ul id="blog-rel-me-links">
                                
                                    <li><a rel="me" href="https://twitter.com/detronizator" target="_blank"><i class="icon-twitter"></i></a></li>
                                
                                    <li><a rel="me" href="https://github.com/detro" target="_blank"><i class="icon-github"></i></a></li>
                                
                                    <li><a rel="me" href="http://linkedin.com/in/ivandemarino" target="_blank"><i class="icon-linkedin"></i></a></li>
                                
                                    <li><a rel="me" href="http://instagram.com/detronizator" target="_blank"><i class="icon-instagram"></i></a></li>
                                
                                    <li><a rel="me" href="rss" target="_blank"><i class="icon-rss"></i></a></li>
                                
                            </ul>
                        
                    </nav>

                </header>
            </div>

            <div id="main" class="pure-u-1">

                <div id="blog-content">
                    <section class="post">

    <header>
        <h1>From Wordpress to Bloggart</h1>

        <p class="post-meta">
            Monday, 11 Oct 2010
            &nbsp;&nbsp;&nbsp;
            
                <a class="post-tag" href="#"><i class="icon-tag"></i> code</a>
                &sdot;
            
                <a class="post-tag" href="#"><i class="icon-tag"></i> python</a>
                &sdot;
            
                <a class="post-tag" href="#"><i class="icon-tag"></i> blog</a>
                &sdot;
            
                <a class="post-tag" href="#"><i class="icon-tag"></i> export</a>
                &sdot;
            
                <a class="post-tag" href="#"><i class="icon-tag"></i> migration</a>
                &sdot;
            
                <a class="post-tag" href="#"><i class="icon-tag"></i> wordpress</a>
                &sdot;
            
                <a class="post-tag" href="#"><i class="icon-tag"></i> bloggart</a>
                &sdot;
            
                <a class="post-tag" href="#"><i class="icon-tag"></i> appengine</a>
                &sdot;
            
                <a class="post-tag" href="#"><i class="icon-tag"></i> opensource</a>
                
            
        </p>
    </header>

    <div class="post-body">
        <p>This post has been in my &quot;TODO list&quot; long enough. It&#39;s time to put it in words.
Let&#39;s go!</p>

<p>As you probably know, <a href="http://blog.ivandemarino.me/2010/08/30/Hello-World-again">I decided to give up Wordpress.org</a>
in favour of <a href="http://github.com/detro/bloggart">Bloggart on App Engine</a>. A great choice so far I must say.</p>

<div style="text-align: center; ">
<img src="http://farm4.static.flickr.com/3646/3482243965_02d4129590_b.jpg" alt="Migration" style="width: 500px; "/>
<br />
<em>Migration, a proper one</em>
</div>

<h3>What I wanted to achieve</h3>

<p>My aim was to migrate more than 6 years of content (posts <em>and</em> comments) from my previous blog at <strong>detronizator.org</strong> into a bloggart installation.
Why bloggart? <a href="http://blog.notdot.net/">Nick Johnson</a>, the original author of Bloggart on Appengine,
wrote <a href="http://blog.notdot.net/2009/10/Writing-a-blog-system-on-App-Engine">a series of article</a>
on how to build a nice, little, smart blogging app on App Engine.
At the same time, work on <a href="http://www.txty.mobi">txty.mobi</a> started to get more and more engaging,
making me a lover (and advocate) of <a href="code.google.com/appengine/">Google App Engine</a>.
Plus, I was interested in &quot;starting from scratch&quot;: <a href="http://www.wordpress.org">Wordpress.org</a>
is a great project, but I just didn&#39;t feel it <em>&quot;mine enough&quot;</em>. My blog must feel really <em>mine</em>:
it&#39;s about me after all.</p>

<h4>Quick and Easy? Not really...</h4>

<p>Migrating all <em>that shit</em> from my previous host was clearly not an easy task. Some reasons were:</p>

<ul>
<li>My Wordpress installation was sitting on a <a href="http://www.mysql.com">MySQL DB</a>: App Engine is based on <a href="http://code.google.com/appengine/docs/python/datastore/">Google Datastore API</a></li>
<li>I decided to change domain to <em>ivandemarino.me</em>: this needed redirection handling, domain transfer and <em>trying to look not too fool in crawler&#39;s eyes</em></li>
<li>Comments: how the hell am I going to handle those given that Bloggart doesn&#39;t provide it but relays on <a href="http://disqus.com/">Disqus</a>?</li>
</ul>

<p>It took some planning and step-by-step strategy. What follows is an attempt to do exactly that.</p>

<h4>So, what&#39;s this all about?</h4>

<p>This post will be a walk-through of what it got to do the Migration.
It will have some of the characteristics of &quot;classic&quot; howtos, but I won&#39;t go too much in details when,
in my opinion, a description of a trivial task will be enough.</p>

<p>Expect some code, some <a href="http://en.wikipedia.org/wiki/Command-line_interface">CLI</a> instructions,
and make sure that you have at least went through
the <a href="http://code.google.com/appengine/docs/python/gettingstarted/">&quot;Getting Started&quot; of App Engine</a> before doing this:
I can&#39;t cover that as well.</p>

<h3>Step 1: Export your Wordpress Data</h3>

<p>Let&#39;s start easy. What you want to do is to backup your Wordpress blog. <a href="http://codex.wordpress.org/WordPress_Backups">Here is how</a>.</p>

<p>What we really need, though, is an <em>&quot;XML Export&quot;</em> of the blog. <a href="http://en.blog.wordpress.com/2006/06/12/xml-import-export/">Matt here explains</a> how to do
exactly that. The result in my case was an enormous (for a personal irrelevant blog like mine) <strong>6MB</strong>! Yes, I write a lot of bulls**t! ;)
The result will be something looking like:</p>
<div class="highlight"><pre><code class="xml language-xml" data-lang="xml"><span class="nt">&lt;rss</span> <span class="na">xmlns:excerpt=</span><span class="s">&quot;http://wordpress.org/export/1.0/excerpt/&quot;</span>
    <span class="na">xmlns:content=</span><span class="s">&quot;http://purl.org/rss/1.0/modules/content/&quot;</span>
    <span class="na">xmlns:wfw=</span><span class="s">&quot;http://wellformedweb.org/CommentAPI/&quot;</span>
    <span class="na">xmlns:dc=</span><span class="s">&quot;http://purl.org/dc/elements/1.1/&quot;</span>
    <span class="na">xmlns:wp=</span><span class="s">&quot;http://wordpress.org/export/1.0/&quot;</span>
    <span class="na">version=</span><span class="s">&quot;2.0&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;channel&gt;</span>
        <span class="nt">&lt;title&gt;</span>Your blog title<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link&gt;</span>http://www.yourblog.com<span class="nt">&lt;/link&gt;</span>
        <span class="nt">&lt;description&gt;</span>Bla bla bla<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;pubDate&gt;</span>Sun, 30 May 2010 19:15:05 +0000<span class="nt">&lt;/pubDate&gt;</span>
        <span class="c">&lt;!-- ... more info about your blog ... --&gt;</span>
        <span class="nt">&lt;wp:category&gt;</span>
            <span class="nt">&lt;wp:category_nicename&gt;</span>cat<span class="nt">&lt;/wp:category_nicename&gt;</span>
            <span class="nt">&lt;wp:category_parent/&gt;</span>
            <span class="nt">&lt;wp:cat_name&gt;</span>Category<span class="nt">&lt;/wp:cat_name&gt;</span>
            <span class="nt">&lt;wp:category_description&gt;</span>Category Description<span class="nt">&lt;/wp:category_description&gt;</span>
        <span class="nt">&lt;/wp:category&gt;</span>
        <span class="c">&lt;!-- ... more category ... --&gt;</span>
        <span class="nt">&lt;wp:tag&gt;</span>
            <span class="nt">&lt;wp:tag_slug&gt;</span>movie<span class="nt">&lt;/wp:tag_slug&gt;</span>
            <span class="nt">&lt;wp:tag_name&gt;</span>movie<span class="nt">&lt;/wp:tag_name&gt;</span>
        <span class="nt">&lt;/wp:tag&gt;</span>
        <span class="c">&lt;!-- ... more tag ... --&gt;</span>
        <span class="nt">&lt;item&gt;</span>
            <span class="nt">&lt;title&gt;</span>A blog post<span class="nt">&lt;/title&gt;</span>
            <span class="nt">&lt;link&gt;</span>http://www.yourblog.com/2005/12/13/a-blog-post/<span class="nt">&lt;/link&gt;</span>
            <span class="nt">&lt;pubDate&gt;</span>Tue, 13 Dec 2005 11:10:14 +0000<span class="nt">&lt;/pubDate&gt;</span>
            <span class="nt">&lt;dc:creator&gt;</span><span class="cp">&lt;![CDATA[You]]&gt;</span><span class="nt">&lt;/dc:creator&gt;</span>
            <span class="nt">&lt;category&gt;</span><span class="cp">&lt;![CDATA[Category]]&gt;</span><span class="nt">&lt;/category&gt;</span>
            <span class="c">&lt;!-- ... body and other stuff --&gt;</span>
        <span class="nt">&lt;/item&gt;</span>
        <span class="c">&lt;!-- ... more items/articles ... --&gt;</span>    
</code></pre></div>
<p><strong>Save it somewhere safe</strong>. <em>Why do we need the XML? Isn&#39;t the SQL backup enough?</em>
No, because Bloggart has a nice tool to import the XML export. More about this later.</p>

<h3>Step 2: Clone, Setup and Deploy the new blog</h3>

<p>So, you want to get a nice clean installation of Bloggart in the cloud. Open your CLI and type:</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash"><span class="nv">$ </span>git clone git://github.com/detro/bloggart.git
<span class="nv">$ </span><span class="nb">cd </span>bloggart
<span class="nv">$ </span>git submodule update --init
</code></pre></div>
<p>This will clone the latest master of my branch of Bloggart, where I host all my additions, tweaks and changes to Bloggart.
<a href="http://github.com/Arachnid/bloggart">Nick&#39;s original branch</a> hasn&#39;t been updated since June 2010.</p>

<p>Now, edit <code>app.yaml</code>&#39;s <code>application:</code> field with your <strong>Application Identifier</strong> that you
just created <a href="https://appengine.google.com/start/createapp?">here</a> (you did it, right?).
Then, edit the <code>config.py</code> following the internal comments/documentation; it should be pretty straightforward.
Bear in mind that there are configuration parameters
that are very much related with UI and stuff like that. But also there are parameters like
the <a href="https://www.google.com/webmasters/tools/h">Google Sitemap</a>
or Disqus: take care of this stuff properly, otherwise you will get just an half-assed blog.</p>

<p>Take particular care of Disqus: once you create a forum (that will be populated by the comments on your new Blog)
(ah, don&#39;t forget to note down the <strong>&quot;Disqus Forum Name&quot;</strong>),
and logged in, you will need to retrieve something important: the <strong>&quot;Disqus User Key&quot;</strong>. To do that, once you logged in Disqus,
go at <a href="http://disqus.com/api/get_my_key/">http://disqus.com/api/get<em>my</em>key/</a>, and annotate somewhere the key.
You will need this later on as well.</p>

<p>No, I won&#39;t go more in details: if you are not <strong>techy enough</strong> to read the comments in the <code>config.py</code> and figure out what to do, why are you even reading this?</p>

<p>Well, now you should be ready to deploy!</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd</span> ..
<span class="nv">$ </span>appcfg.py update bloggart
</code></pre></div>
<p>If you are not interested in migrating, but just starting a blog, then you are done. Your blog is up-and-running already.
Otherwise, read on.</p>

<h3>Step 3: <code>migrate.py</code></h3>

<p>The great thing about Open Source software, is that there is almost always someone that had your problem before and found (or built) a solution.
So that you can <em>stand on shoulders of Giants</em>. In this case is <a href="http://blog.andialbrecht.de/">Andi Albrecht</a> that added support for Wordpress migration
in <a href="http://github.com/detro/bloggart/commits/master/migrate.py">migrate.py</a>. This suited my needs (and will probably suite yours).</p>

<p>Unfortunately though, <code>migrate.py</code> doesn&#39;t come with a great deal of UI. It&#39;s just a set of classes. We will have to fill the gap.
But fortunately Google App Engine is not short of surprises.</p>

<h4>remote_api</h4>

<p><a href="http://code.google.com/appengine/articles/remote_api.html">remote_api</a> is a module introduced in 1.1.9 that allows
remote access to the App Engine datastore, using the same APIs you know and love from writing App Engine Apps.
What practically does, is provide a python-console that executes code in the context of your remote Application. Isn&#39;t that Great?</p>

<p>This great idea is made of two parts:</p>

<ul>
<li>a <strong>&quot;handler&quot;</strong>, which you install on the server to handle remote datastore requests</li>
<li>a <strong>&quot;stub&quot;</strong>, which you set up on the client to translate datastore requests into calls to the remote handler</li>
</ul>

<p>We already took care of the &quot;handler&quot;, already set up in bloggart. You can create your &quot;stub&quot;
following the instruction <a href="http://code.google.com/appengine/articles/remote_api.html">here</a>, or appreciate
that bloggart ALREADY provides one <em>ready-to-go</em> as well: find it at <code>bloggart/scripts/remote.py</code>.</p>

<h4>ready, set, migrate</h4>

<p>We are all set for using <code>migrate.py</code>. Run <code>remote.py</code> and type:</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="kn">import</span> <span class="nn">migrate</span><span class="p">;</span>
<span class="n">wpmig</span> <span class="o">=</span> <span class="n">migrate</span><span class="o">.</span><span class="n">WordpressMigration</span><span class="p">(</span><span class="n">path_to_your_wordpress_export_xml</span><span class="p">,</span> <span class="n">the_disqus_key</span><span class="p">,</span> <span class="n">the_disqus_forum_name</span><span class="p">);</span>
<span class="n">wpmig</span><span class="o">.</span><span class="n">migrate_all</span><span class="p">();</span>
</code></pre></div>
<p>This will kick off Deferred Tasks that will store in App Engine your blog posts and in Disqus the associated comments.</p>

<h4>wait, I&#39;m having a problem here</h4>

<p>Yes, what I just described might fail. For sure if you have an <em>Export XML</em> that takes <strong>more than 1MB</strong>.
In fact, the <code>remote_api</code> are limited to handle HTTP File Uploads <strong>smaller than 1MB</strong>.</p>

<p>Myself I had a file of <strong>almost 7MB</strong>! How did I do then? I Googled, of course, and found
a nice little script called <a href="http://www.ogmaciel.com/?p=993">choppedpress.py</a>.</p>

<p>This little script does something extremely useful:</p>

<blockquote>
<p>ChoppedPress lets you split the WordPress XML export file into smaller files
that can be used to import your posts, comments, tags and categories into a
new WordPress installation.</p>
</blockquote>

<p>Use it to split your Wordpress Export XML into chunks (remember, smaller than 1MB). Then run the <code>remote.py</code>
and do like:</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="kn">import</span> <span class="nn">migrate</span><span class="p">;</span>
<span class="n">wpmig</span> <span class="o">=</span> <span class="n">migrate</span><span class="o">.</span><span class="n">WordpressMigration</span><span class="p">(</span><span class="n">path_to_your_wordpress_export_xml</span><span class="o">-</span><span class="n">chunk</span><span class="o">-</span><span class="mo">01</span><span class="p">,</span> <span class="n">the_disqus_key</span><span class="p">,</span> <span class="n">the_disqus_forum_name</span><span class="p">);</span>
<span class="n">wpmig</span><span class="o">.</span><span class="n">migrate_all</span><span class="p">();</span>

<span class="n">wpmig</span> <span class="o">=</span> <span class="n">migrate</span><span class="o">.</span><span class="n">WordpressMigration</span><span class="p">(</span><span class="n">path_to_your_wordpress_export_xml</span><span class="o">-</span><span class="n">chunk</span><span class="o">-</span><span class="mo">02</span><span class="p">,</span> <span class="n">the_disqus_key</span><span class="p">,</span> <span class="n">the_disqus_forum_name</span><span class="p">);</span>
<span class="n">wpmig</span><span class="o">.</span><span class="n">migrate_all</span><span class="p">();</span>

<span class="n">wpmig</span> <span class="o">=</span> <span class="n">migrate</span><span class="o">.</span><span class="n">WordpressMigration</span><span class="p">(</span><span class="n">path_to_your_wordpress_export_xml</span><span class="o">-</span><span class="n">chunk</span><span class="o">-</span><span class="mo">03</span><span class="p">,</span> <span class="n">the_disqus_key</span><span class="p">,</span> <span class="n">the_disqus_forum_name</span><span class="p">);</span>
<span class="n">wpmig</span><span class="o">.</span><span class="n">migrate_all</span><span class="p">();</span>
<span class="o">...</span>
</code></pre></div>
<h3>Step 4: <code>301 Permanent Redirect</code></h3>

<p>Well, you don&#39;t necessarily need this, but it helps if you want to retain some of your old traffic.
Setup a <code>301 Permanent Redirect</code> from your old URL to the new one.
Need help for this? Just <a href="http://www.google.com/search?sourceid=chrome&amp;ie=UTF-8&amp;q=setup+301+permanent+redirect">Google it</a>.</p>

<p>But if you want a more fine grained control over the redirect, why don&#39;t you give a look
at my little project <a href="http://github.com/detro/gredirector">gredirector</a>?
More info <a href="http://blog.ivandemarino.me/2010/09/29/gredirector---HTTP-301-through-App-Engine">here</a>.</p>

<h3>Conclusion</h3>

<p>Well, I&#39;m sure this is a very &quot;poor&quot; how to: it could be definitely improved.
But what would be the point if no one reads it?</p>

<p>Instead, if you find it useful and want to know more or just have questions, don&#39;t hesitate to leave a message
here and I&#39;ll make sure to answer as quickly as I can. I&#39;ll even eventually update the post if I find
that a particular aspect needs clarification: THIS will really help to improve the howto, collectively.</p>

<p>I really want to help people take a look at <a href="http://github.com/detro/bloggart">Bloggart</a>, <a href="http://blog.notdot.net/">Nick&#39;s</a> great idea:
it&#39;s probably a very small project, but there are so many interesting
things in it, that it&#39;s worth caring (if you are like me). This to say that this post is the first of more
that will be focused on some of the new features I&#39;m adding to bloggart.</p>

<p><em>Happy Bloggarting ;)</em></p>

    </div>

</section>

                </div>

                <footer id="blog-footer">
                    
                        <span>Hosted on <a href="http://pages.github.com/">GitHub Pages</a></span>
                    
                    
                        <span>Powered by <a href="http://jekyllrb.com/">Jekyll</a></span>
                    
                    
                    
                        <span>Licensed under <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC ASA 3.0</a></span>
                    
                </footer>

            </div>
        </div>

        <script type="text/javascript" src="http://yui.yahooapis.com/combo?3.12.0/yui-base/yui-base-min.js&3.12.0/oop/oop-min.js&3.12.0/event-custom-base/event-custom-base-min.js&3.12.0/features/features-min.js&3.12.0/dom-core/dom-core-min.js&3.12.0/dom-base/dom-base-min.js&3.12.0/selector-native/selector-native-min.js&3.12.0/selector/selector-min.js&3.12.0/node-core/node-core-min.js&3.12.0/color-base/color-base-min.js&3.12.0/dom-style/dom-style-min.js&3.12.0/node-base/node-base-min.js&3.12.0/event-base/event-base-min.js"></script>
        <script>
            YUI().use('node', 'event', function (Y) {
                Y.one("#toggle-blog-navigation").on("click", function(e) {
                    Y.one("#blog-navigation").toggleClass("open");
                    e.preventDefault();
                });
            });
        </script>
    </body>
</html>
